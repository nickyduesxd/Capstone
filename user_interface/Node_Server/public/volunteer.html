<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marine Corps Marathon First Aid Report Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            text-align: center;
        }
        .form-section {
            margin-bottom: 20px;
        }
        label {
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        textarea {
            height: 100px;
        }
        .form-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .form-footer {
            text-align: center;
            margin-top: 20px;
        }
        .search-container {
            margin-bottom: 20px;
            text-align: center;
        }
        .search-container input {
            width: 48%;
            margin-right: 4%;
        }
        .search-container button {
            width: 48%;
        }
    </style>
</head>
<body>

    <!-- Search Form -->
    <div class="search-container">
        <input type="text" id="search-name" placeholder="Enter person's name" />
        <button onclick="searchReport()">Search</button>
    </div>

    <!-- Report Submission Form -->
    <form action="/submit_form" method="POST">
        <!-- Incident Details -->
        <div class="form-section">
            <h3>Incident Details</h3>
            <label for="incident-date">Date of Incident:</label>
            <input type="date" id="incident-date" name="incident-date" required>
            
            <label for="incident-time">Time of Incident:</label>
            <input type="time" id="incident-time" name="incident-time" required>
            
            <label for="incident-location">Location of Incident:</label>
            <input type="text" id="incident-location" name="incident-location" placeholder="e.g., mile marker, hydration station" required>
        </div>

        <!-- Injured Person Details -->
        <div class="form-section">
            <h3>Injured Person Details</h3>
            <label for="person-name">Full Name:</label>
            <input type="text" id="person-name" name="person-name" required>

            <label for="person-contact">Contact Number:</label>
            <input type="tel" id="person-contact" name="person-contact" required>

            <label for="person-email">Email Address:</label>
            <input type="email" id="person-email" name="person-email" required>
        </div>

        <!-- Injury/Illness Details -->
        <div class="form-section">
            <h3>Injury/Illness Details</h3>
            <label for="injury-type">Type of Injury/Illness:</label>
            <input type="text" id="injury-type" name="injury-type" required>

            <label for="affected-body-part">Affected Body Part(s):</label>
            <input type="text" id="affected-body-part" name="affected-body-part" required>

            <label for="visible-symptoms">Visible Symptoms:</label>
            <textarea id="visible-symptoms" name="visible-symptoms" placeholder="e.g., bleeding, bruising, swelling, dizziness, etc." required></textarea>

            <label for="cause">Cause of Incident:</label>
            <input type="text" id="cause" name="cause" required>
        </div>

        <!-- First Aid Treatment Given -->
        <div class="form-section">
            <h3>First Aid Treatment Provided</h3>
            <label for="first-aid-measures">First Aid Measures Taken:</label>
            <textarea id="first-aid-measures" name="first-aid-measures" placeholder="e.g., applied bandage, gave water, performed CPR" required></textarea>

            <label for="treatment-details">Details of Treatment:</label>
            <textarea id="treatment-details" name="treatment-details" placeholder="e.g., time treatment was administered, any medication given, method of application" required></textarea>
        </div>

        <!-- First Aider Details -->
        <div class="form-section">
            <h3>First Aider Details</h3>
            <label for="first-aider-name">Name of First Aider:</label>
            <input type="text" id="first-aider-name" name="first-aider-name" required>

            <label for="first-aider-contact">Contact Number:</label>
            <input type="tel" id="first-aider-contact" name="first-aider-contact" required>

            <label for="first-aider-qualification">Qualification/Training:</label>
            <input type="text" id="first-aider-qualification" name="first-aider-qualification" required>
        </div>


        <!-- Additional Notes -->
        <div class="form-section">
            <h3>Additional Notes (if any)</h3>
            <textarea id="additional-notes" name="additional-notes" placeholder="Any other relevant details"></textarea>
        </div>

        <!-- Signature -->
        <div class="form-section">
            <label for="first-aider-signature">First Aiderâ€™s Signature:</label>
            <input type="text" id="first-aider-signature" name="first-aider-signature" required>

            <label for="signature-date">Date:</label>
            <input type="date" id="signature-date" name="signature-date" required>
        </div>

        <div class="form-footer">
            <button type="submit" id="submit-button">Submit Report</button>
            <br></br>
            <button type="button" id="update-button" style="display:none" onclick="updateReport()">Update Report</button>
        </div>
    </form>

    <script>
        // Function to search the report and display it in the form
        async function searchReport() {
            const name = document.getElementById("search-name").value;

            if (!name) {
                alert("Please enter a name to search.");
                return;
            }

            try {
                const response = await fetch(`/searchReport?name=${name}`);
                if (response.ok) {
                    const report = await response.json();

                    // Fill the form with the report data
                    document.getElementById('incident-date').value = report['incident-date'];
                    document.getElementById('incident-time').value = report['incident-time'];
                    document.getElementById('incident-location').value = report['incident-location'];
                    document.getElementById('person-name').value = report['person-name'];
                    document.getElementById('person-contact').value = report['person-contact'];
                    document.getElementById('person-email').value = report['person-email'];
                    document.getElementById('injury-type').value = report['injury-type'];
                    document.getElementById('affected-body-part').value = report['affected-body-part'];
                    document.getElementById('visible-symptoms').value = report['visible-symptoms'];
                    document.getElementById('cause').value = report['cause'];
                    document.getElementById('first-aid-measures').value = report['first-aid-measures'];
                    document.getElementById('treatment-details').value = report['treatment-details'];
                    document.getElementById('first-aider-name').value = report['first-aider-name'];
                    document.getElementById('first-aider-contact').value = report['first-aider-contact'];
                    //document.getElementById('first-aider-qualification').value = report['first-aider-qualification'];
                    //document.getElementById('witness-name-1').value = report['witness-name-1'];
                    //document.getElementById('witness-contact-1').value = report['witness-contact-1'];
                    ///document.getElementById('witness-name-2').value = report['witness-name-2'];
                    //document.getElementById('witness-contact-2').value = report['witness-contact-2'];
                    document.getElementById('additional-notes').value = report['additional-notes'];
                    document.getElementById('first-aider-signature').value = report['first-aider-signature'];
                    document.getElementById('signature-date').value = report['signature-date'];

                    // Hide submit and show update button
                    document.getElementById('submit-button').style.display = 'none';
                    document.getElementById('update-button').style.display = 'inline-block';
                } else {
                    alert('Report not found.');
                }
            } catch (error) {
                console.error('Error searching for report:', error);
                alert('An error occurred while fetching the report.');
            }
        }

        // Function to update the report
        async function updateReport() {
    const updatedReport = {
        'incident-date': document.getElementById('incident-date').value,
        'incident-time': document.getElementById('incident-time').value,
        'incident-location': document.getElementById('incident-location').value,
        'person-name': document.getElementById('person-name').value,
        'person-contact': document.getElementById('person-contact').value,
        'person-email': document.getElementById('person-email').value,
        'injury-type': document.getElementById('injury-type').value,
        'affected-body-part': document.getElementById('affected-body-part').value,
        'visible-symptoms': document.getElementById('visible-symptoms').value,
        'cause': document.getElementById('cause').value,
        'first-aid-measures': document.getElementById('first-aid-measures').value,
        'treatment-details': document.getElementById('treatment-details').value,
        'first-aider-name': document.getElementById('first-aider-name').value,
        'first-aider-contact': document.getElementById('first-aider-contact').value,
        //'first-aider-qualification': document.getElementById('first-aider-qualification').value,
        //'witness-name-1': document.getElementById('witness-name-1').value,
        //'witness-contact-1': document.getElementById('witness-contact-1').value,
        //'witness-name-2': document.getElementById('witness-name-2').value,
        //'witness-contact-2': document.getElementById('witness-contact-2').value,
        'additional-notes': document.getElementById('additional-notes').value,
        'first-aider-signature': document.getElementById('first-aider-signature').value,
        'signature-date': document.getElementById('signature-date').value
    };

    const name = updatedReport['person-name'];

    // First, delete the existing report
    try {
        await fetch('/deleteReport', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name })
        });

        // Then update with the new report
        const response = await fetch('/updateReport', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updatedReport)
        });

        if (response.ok) {
            alert('Report updated successfully!');

            // Clear form fields
            document.getElementById('incident-date').value = '';
            document.getElementById('incident-time').value = '';
            document.getElementById('incident-location').value = '';
            document.getElementById('person-name').value = '';
            document.getElementById('person-contact').value = '';
            document.getElementById('person-email').value = '';
            document.getElementById('injury-type').value = '';
            document.getElementById('affected-body-part').value = '';
            document.getElementById('visible-symptoms').value = '';
            document.getElementById('cause').value = '';
            document.getElementById('first-aid-measures').value = '';
            document.getElementById('treatment-details').value = '';
            document.getElementById('first-aider-name').value = '';
            document.getElementById('first-aider-contact').value = '';
            //document.getElementById('first-aider-qualification').value = '';
            //document.getElementById('witness-name-1').value = '';
            //document.getElementById('witness-contact-1').value = '';
            //document.getElementById('witness-name-2').value = '';
            //document.getElementById('witness-contact-2').value = '';
            document.getElementById('additional-notes').value = '';
            document.getElementById('first-aider-signature').value = '';
            document.getElementById('signature-date').value = '';

            // Hide the "Update" button and show the "Submit" button
            document.querySelector('button[type="button"]').style.display = 'none';
            document.querySelector('button[type="submit"]').style.display = 'block';
        } else {
            alert('Failed to update report.');
        }
    } catch (error) {
        console.error('Error updating report:', error);
        alert('Error updating the report.');
    }
}

// Automatically set current date and time in the form
window.onload = function() {
    updateDateTime(); // Set date and time when the page first loads
    setInterval(updateDateTime, 60000); // Update every minute (60000 ms)
};

function updateDateTime() {
    const currentDate = new Date();

    // Format the current date to YYYY-MM-DD
    const formattedDate = currentDate.toISOString().split('T')[0]; 

    // Format the current time to HH:MM
    const formattedTime = currentDate.toTimeString().split(' ')[0].slice(0, 5); 

    // Set the values for date and time inputs
    document.getElementById('incident-date').value = formattedDate;
    document.getElementById('incident-time').value = formattedTime;
    document.getElementById('signature-date').value = formattedDate;
}


    </script>

</body>

</html>
